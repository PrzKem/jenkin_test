pipeline {
    agent {
        node {
            label 'main' //set your kubernetes node
        }
    }
   environment {
     GITHUB_NAME = "PrzeKem"
     GITHUB_PROJECT = "jenkin_test"
     YOUR_DOCKERHUB_USERNAME = "przekem"
     SERVICE_NAME = "test"
     REPOSITORY_TAG="${YOUR_DOCKERHUB_USERNAME}/${SERVICE_NAME}:${BUILD_ID}"
   }

   stages {
    stage('Preparation') {
        steps {
            cleanWs()
            // git url: "https://github.com/${GITHUB_NAME}/${GITHUB_PROJECT}"
        }
    }
    stage('Build') {
        steps {
            sh 'echo No build required for Gateway'
        }
    }

  stage('Build and Push Image') {
     steps {
       sh 'docker image build -t ${REPOSITORY_TAG} .'
       sh 'docker tag ${REPOSITORY_TAG} localhost:32000/${REPOSITORY_TAG}'
       sh 'docker push localhost:32000/${REPOSITORY_TAG}'
     }
  } 

  stage('Deploy to Cluster') {
    steps {
      sh './k8s/create.sh'
    }
  }
 }
}